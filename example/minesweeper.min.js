"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var t=0;t<i.length;t++){var s=i[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),e}var Field=function(){function e(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:700,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:70;_classCallCheck(this,e),this.element=i,this.width=s,this.height=n,this.resolution=l,this.mines=t,this.cols=Math.ceil(this.width/this.resolution),this.rows=Math.ceil(this.height/this.resolution),this.element.style.height=this.height+"px",this.element.style.width=this.width+"px",this.minesweeper,this.minesPlaced=[],this.bombValue="bomb",this.fontSize=15,this.grassClossedColorHover="#1F6D04",this.grassClossedColor="#79bf00",this.grassOpenedColor="#b6ff38"}return _createClass(e,[{key:"build",value:function(){var e=this.generateMap(),i=this.placeMines(e),t=this.placeHints(i);this.minesweeper=t,fields.draw(t)}},{key:"defeat",value:function(){alert("You lose!"),this.reset()}},{key:"generateMap",value:function(){var e=this;return new Array(this.cols).fill(null).map((function(){return new Array(e.rows).fill(null).map((function(){return{value:"0",state:"closed"}}))}))}},{key:"placeMines",value:function(e){for(var i=this.mines,t=0;t<i;)for(var s=!1,n=0;n<e.length&&!s;n++)for(var l=0;l<e[n].length&&!s;l++){Math.random()<1e-5&&0==s&&e[n][l].value!==this.bombValue&&(e[n][l].value=this.bombValue,this.minesPlaced.push({i:n,j:l}),t++,s=!0)}return e}},{key:"placeHints",value:function(e){for(var i=0;i<e.length;i++)for(var t=0;t<e[i].length;t++)if(e[i][t].value!==this.bombValue){var s=0;t<this.rows-1&&e[i][t+1].value==this.bombValue&&(s+=1),t>0&&e[i][t-1].value==this.bombValue&&(s+=1),i>0&&e[i-1][t].value==this.bombValue&&(s+=1),i<this.cols-1&&e[i+1][t].value==this.bombValue&&(s+=1),t<this.rows-1&&i<this.cols-1&&e[i+1][t+1].value==this.bombValue&&(s+=1),i>0&&t<this.rows-1&&e[i-1][t+1].value==this.bombValue&&(s+=1),t>0&&i>0&&e[i-1][t-1].value==this.bombValue&&(s+=1),t>0&&i<this.cols-1&&e[i+1][t-1].value==this.bombValue&&(s+=1),0==s&&(s=" "),e[i][t].value=s}return e}},{key:"openTile",value:function(e,i,t){var s=this.minesweeper[e][i];if("open"!=s.state){if(this.minesweeper[e][i].state="open",s.value==this.bombValue)return this.openAllTiles(),void this.defeat();t.innerText=s.value,t.style.backgroundColor=this.grassOpenedColor," "==s.value&&this.openEmptyNeighbors(e,i)}}},{key:"openEmptyNeighbors",value:function(e,i){i<this.rows-1&&this.minesweeper[e][i+1].value!==this.bombValue&&"open"!==this.minesweeper[e][i+1].state&&(this.displayTile(this.minesweeper[e][i+1],e,i+1)," "==this.minesweeper[e][i+1].value&&this.openEmptyNeighbors(e,i+1)),i>0&&this.minesweeper[e][i-1].value!==this.bombValue&&"open"!==this.minesweeper[e][i-1].state&&(this.displayTile(this.minesweeper[e][i-1],e,i-1)," "==this.minesweeper[e][i-1].value&&this.openEmptyNeighbors(e,i-1)),e>0&&this.minesweeper[e-1][i].value!==this.bombValue&&"open"!==this.minesweeper[e-1][i].state&&(this.displayTile(this.minesweeper[e-1][i],e-1,i)," "==this.minesweeper[e-1][i].value&&this.openEmptyNeighbors(e-1,i)),e<this.cols-1&&this.minesweeper[e+1][i].value!==this.bombValue&&"open"!==this.minesweeper[e+1][i].state&&(this.displayTile(this.minesweeper[e+1][i],e+1,i)," "==this.minesweeper[e+1][i].value&&this.openEmptyNeighbors(e+1,i)),i<this.rows-1&&e<this.cols-1&&this.minesweeper[e+1][i+1].value!==this.bombValue&&"open"!==this.minesweeper[e+1][i+1].state&&(this.displayTile(this.minesweeper[e+1][i+1],e+1,i+1)," "==this.minesweeper[e+1][i+1].value&&this.openEmptyNeighbors(e+1,i+1)),e>0&&i<this.rows-1&&this.minesweeper[e-1][i+1].value!==this.bombValue&&"open"!==this.minesweeper[e-1][i+1].state&&(this.displayTile(this.minesweeper[e-1][i+1],e-1,i+1)," "==this.minesweeper[e-1][i+1].value&&this.openEmptyNeighbors(e-1,i+1)),i>0&&e>0&&this.minesweeper[e-1][i-1].value!==this.bombValue&&"open"!==this.minesweeper[e-1][i-1].state&&(this.displayTile(this.minesweeper[e-1][i-1],e-1,i-1)," "==this.minesweeper[e-1][i-1].value&&this.openEmptyNeighbors(e-1,i-1)),i>0&&e<this.cols-1&&this.minesweeper[e+1][i-1].value!==this.bombValue&&"open"!==this.minesweeper[e+1][i-1].state&&(this.displayTile(this.minesweeper[e+1][i-1],e+1,i-1)," "==this.minesweeper[e+1][i-1].value&&this.openEmptyNeighbors(e+1,i-1))}},{key:"openAllTiles",value:function(){for(var e=this.minesweeper,i=0;i<e.length;i++)for(var t=0;t<e[i].length;t++){var s=e[i][t];s.value==this.bombValue?this.displayBomb(s,i,t):this.displayTile(s,i,t)}}},{key:"displayTile",value:function(e,i,t){this.minesweeper[i][t].state="open";var s=document.getElementById("tile_"+i+"_"+t);s.innerText=e.value,s.style.backgroundColor=this.grassOpenedColor}},{key:"displayBomb",value:function(e,i,t){var s=document.getElementById("tile_"+i+"_"+t);s.style.backgroundColor=this.grassOpenedColor,s.style.paddingTop=(this.resolution-this.resolution/2)/2+"px",s.innerHTML="<img src='./images/bomb.png' style='width: "+this.resolution/2+"px'>"}},{key:"displayAlert",value:function(e,i){var t=document.getElementById("tile_"+e+"_"+i),s=this.minesweeper[e][i];"alert"==s.state?(s.state="blocked",t.style.paddingTop=this.resolution/2-this.fontSize+5+"px",t.innerHTML=" "):(s.state="alert",t.style.paddingTop=(this.resolution-this.resolution/2)/2+"px",t.innerHTML="<img src='./images/alert.png' style='width: "+this.resolution/2+"px'>"),this.verifyWinning()}},{key:"verifyWinning",value:function(){for(var e=this.minesPlaced,i=e.length,t=0,s=0;s<i;s++){var n=e[s];"alert"==this.minesweeper[n.i][n.j].state&&this.minesweeper[n.i][n.j].value==this.bombValue&&t++}t==i&&(alert("You win!"),this.reset())}},{key:"draw",value:function(e){for(var i=this,t=function(t){for(var s=function(s){e[t][s];var n=new Tile(i.resolution,t,s).build();n.addEventListener("click",(function(e,i){open(t,s,e.target)}),!1),n.addEventListener("contextmenu",(function(e){return e.preventDefault(),displayAlert(t,s),!1}),!1),i.element.appendChild(n)},n=0;n<e[t].length;n++)s(n)},s=0;s<e.length;s++)t(s)}},{key:"reset",value:function(){this.minesweeper=null,this.minesPlaced=[],this.element.innerHTML="",this.build()}}]),e}(),Tile=function(){function e(i,t,s){_classCallCheck(this,e),this.resolution=i,this.i=t,this.j=s,this.fontSize=15,this.grassClossedColorHover="#1F6D04",this.grassClossedColor="#79bf00",this.grassOpenedColor="#b6ff38"}return _createClass(e,[{key:"build",value:function(){var e=document.createElement("div");return e.id="tile_"+this.i+"_"+this.j,e.style.backgroundColor=this.grassClossedColor,e.style.float="left",e.style.width=this.resolution+"px",e.style.height=this.resolution+"px",e.style.border="1px solid",e.style.textAlign="center",e.style.fontSize=this.fontSize,e.style.cursor="pointer",e.style.paddingTop=this.resolution/2-this.fontSize+5+"px",e}}]),e}();