"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var Field=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:700,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:70;_classCallCheck(this,e),this.element=t,this.width=s,this.height=n,this.resolution=l,this.mines=i,this.cols=Math.ceil(this.width/this.resolution),this.rows=Math.ceil(this.height/this.resolution),this.element.style.height=this.height+"px",this.element.style.width=this.width+"px",this.minesweeper,this.minesPlaced=[],this.bombValue="bomb",this.fontSize=15,this.grassClossedColorHover="#1F6D04",this.grassClossedColor="#79bf00",this.grassOpenedColor="#b6ff38"}return _createClass(e,[{key:"build",value:function(){var e=this.generateMap(),t=this.placeMines(e),i=this.placeHints(t);this.minesweeper=i,fields.draw(i)}},{key:"defeat",value:function(){alert("You lose!"),this.reset()}},{key:"generateMap",value:function(){var e=this;return new Array(this.cols).fill(null).map((function(){return new Array(e.rows).fill(null).map((function(){return{value:"0",state:"closed"}}))}))}},{key:"placeMines",value:function(e){for(var t=this.mines,i=0;i<t;)for(var s=!1,n=0;n<e.length&&!s;n++)for(var l=0;l<e[n].length&&!s;l++){Math.random()<1e-5&&0==s&&e[n][l].value!==this.bombValue&&(e[n][l].value=this.bombValue,this.minesPlaced.push({i:n,j:l}),i++,s=!0)}return e}},{key:"placeHints",value:function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++)if(e[t][i].value!==this.bombValue){var s=0;i<this.rows-1&&e[t][i+1].value==this.bombValue&&(s+=1),i>0&&e[t][i-1].value==this.bombValue&&(s+=1),t>0&&e[t-1][i].value==this.bombValue&&(s+=1),t<this.cols-1&&e[t+1][i].value==this.bombValue&&(s+=1),i<this.rows-1&&t<this.cols-1&&e[t+1][i+1].value==this.bombValue&&(s+=1),t>0&&i<this.rows-1&&e[t-1][i+1].value==this.bombValue&&(s+=1),i>0&&t>0&&e[t-1][i-1].value==this.bombValue&&(s+=1),i>0&&t<this.cols-1&&e[t+1][i-1].value==this.bombValue&&(s+=1),0==s&&(s=" "),e[t][i].value=s}return e}},{key:"openTile",value:function(e,t,i){var s=this.minesweeper[e][t];if("open"!=s.state){if(this.minesweeper[e][t].state="open",s.value==this.bombValue)return this.openAllTiles(),void this.defeat();i.innerText=s.value,i.style.backgroundColor=this.grassOpenedColor," "==s.value&&this.openEmptyNeighbors(e,t)}}},{key:"openEmptyNeighbors",value:function(e,t){t<this.rows-1&&this.minesweeper[e][t+1].value!==this.bombValue&&"open"!==this.minesweeper[e][t+1].state&&(this.displayTile(this.minesweeper[e][t+1],e,t+1)," "==this.minesweeper[e][t+1].value&&this.openEmptyNeighbors(e,t+1)),t>0&&this.minesweeper[e][t-1].value!==this.bombValue&&"open"!==this.minesweeper[e][t-1].state&&(this.displayTile(this.minesweeper[e][t-1],e,t-1)," "==this.minesweeper[e][t-1].value&&this.openEmptyNeighbors(e,t-1)),e>0&&this.minesweeper[e-1][t].value!==this.bombValue&&"open"!==this.minesweeper[e-1][t].state&&(this.displayTile(this.minesweeper[e-1][t],e-1,t)," "==this.minesweeper[e-1][t].value&&this.openEmptyNeighbors(e-1,t)),e<this.cols-1&&this.minesweeper[e+1][t].value!==this.bombValue&&"open"!==this.minesweeper[e+1][t].state&&(this.displayTile(this.minesweeper[e+1][t],e+1,t)," "==this.minesweeper[e+1][t].value&&this.openEmptyNeighbors(e+1,t))}},{key:"openAllTiles",value:function(){for(var e=this.minesweeper,t=0;t<e.length;t++)for(var i=0;i<e[t].length;i++){var s=e[t][i];s.value==this.bombValue?this.displayBomb(s,t,i):this.displayTile(s,t,i)}}},{key:"displayTile",value:function(e,t,i){this.minesweeper[t][i].state="open";var s=document.getElementById("tile_"+t+"_"+i);s.innerText=e.value,s.style.backgroundColor=this.grassOpenedColor}},{key:"displayBomb",value:function(e,t,i){var s=document.getElementById("tile_"+t+"_"+i);s.style.backgroundColor=this.grassOpenedColor,s.style.paddingTop=(this.resolution-this.resolution/2)/2+"px",s.innerHTML="<img src='./images/bomb.png' style='width: "+this.resolution/2+"px'>"}},{key:"displayAlert",value:function(e,t){var i=document.getElementById("tile_"+e+"_"+t),s=this.minesweeper[e][t];"alert"==s.state?(s.state="blocked",i.style.paddingTop=this.resolution/2-this.fontSize+5+"px",i.innerHTML=" "):(s.state="alert",i.style.paddingTop=(this.resolution-this.resolution/2)/2+"px",i.innerHTML="<img src='./images/alert.png' style='width: "+this.resolution/2+"px'>"),this.verifyWinning()}},{key:"verifyWinning",value:function(){for(var e=this.minesPlaced,t=e.length,i=0,s=0;s<t;s++){var n=e[s];"alert"==this.minesweeper[n.i][n.j].state&&this.minesweeper[n.i][n.j].value==this.bombValue&&i++}i==t&&(alert("You win!"),this.reset())}},{key:"draw",value:function(e){for(var t=this,i=function(i){for(var s=function(s){e[i][s];var n=new Tile(t.resolution,i,s).build();n.addEventListener("click",(function(e,t){open(i,s,e.target)}),!1),n.addEventListener("contextmenu",(function(e){return e.preventDefault(),displayAlert(i,s),!1}),!1),t.element.appendChild(n)},n=0;n<e[i].length;n++)s(n)},s=0;s<e.length;s++)i(s)}},{key:"reset",value:function(){this.minesweeper=null,this.minesPlaced=[],this.element.innerHTML="",this.build()}}]),e}(),Tile=function(){function e(t,i,s){_classCallCheck(this,e),this.resolution=t,this.i=i,this.j=s,this.fontSize=15,this.grassClossedColorHover="#1F6D04",this.grassClossedColor="#79bf00",this.grassOpenedColor="#b6ff38"}return _createClass(e,[{key:"build",value:function(){var e=document.createElement("div");return e.id="tile_"+this.i+"_"+this.j,e.style.backgroundColor=this.grassClossedColor,e.style.float="left",e.style.width=this.resolution+"px",e.style.height=this.resolution+"px",e.style.border="1px solid",e.style.textAlign="center",e.style.fontSize=this.fontSize,e.style.cursor="pointer",e.style.paddingTop=this.resolution/2-this.fontSize+5+"px",e}}]),e}();